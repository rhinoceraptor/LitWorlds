// Generated by CoffeeScript 1.7.1
var a, cheerio, request, s, scrape,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

request = require('request');

cheerio = require('cheerio');

scrape = (function() {
  scrape.base_url;

  scrape.new_domain;

  scrape.done = false;

  function scrape(domain, port, new_domain) {
    this.domain = domain;
    this.port = port;
    this.new_domain = new_domain;
    this.change_links = __bind(this.change_links, this);
    this.base_url = "http://" + this.domain + ":" + port + "/";
    this.new_domain = "http://" + this.new_domain;
  }

  scrape.prototype.change_links = function(req) {
    req = this.base_url + req;
    this.new_html = null;
    request(req, (function(_this) {
      return function(err, res, body) {
        var $, links;
        if (!err && res.statusCode === 200) {
          $ = cheerio.load(body);
          links = $('a');
          $(links).each(function(i, link) {
            var ident, new_url, old_url;
            old_url = $(link).attr('href');
            ident = old_url.substring(_this.base_url.length, old_url.length - 1);
            new_url = _this.new_domain + "#encore/" + ident;
            return $(link).attr('href', new_url);
          });
          _this.new_html = String($('body').html());
          console.log(_this.new_html);
          return _this.new_html;
        }
      };
    })(this));
    return this.new_html;
  };

  return scrape;

})();

s = new scrape("brn227.brown.wmich.edu", "7000", "literaryworlds.me");

a = s.change_links('62');

console.log(a);
